From a8166a58ef0af30a57a6196837fba2c537eee13d Mon Sep 17 00:00:00 2001
From: Elliot Buller <elliot@tinylabs.io>
Date: Sun, 21 Jun 2020 14:54:52 -0600
Subject: [PATCH 1/1] Add LOAD_FILE param

---
 rtl/verilog/rl_ram_1r1w.sv         |  8 +++++---
 rtl/verilog/rl_ram_1r1w_generic.sv | 11 +++++++++--
 2 files changed, 14 insertions(+), 5 deletions(-)

diff --git a/rtl/verilog/rl_ram_1r1w.sv b/rtl/verilog/rl_ram_1r1w.sv
index e58cd59..0c47bc7 100644
--- a/rtl/verilog/rl_ram_1r1w.sv
+++ b/rtl/verilog/rl_ram_1r1w.sv
@@ -68,7 +68,8 @@
 module rl_ram_1r1w #(
   parameter ABITS      = 10,
   parameter DBITS      = 32,
-  parameter TECHNOLOGY = "GENERIC"
+  parameter TECHNOLOGY = "GENERIC",
+  parameter LOAD_FILE  = ""
 )
 (
   input                    rst_ni,
@@ -155,8 +156,9 @@ generate
       initial $display ("INFO   : No memory technology specified. Using generic inferred memory (%m)");
 
       rl_ram_1r1w_generic #(
-        .ABITS ( ABITS ),
-        .DBITS ( DBITS ) )
+        .ABITS     ( ABITS ),
+        .DBITS     ( DBITS ),
+        .LOAD_FILE ( LOAD_FILE ) )
       ram_inst (
         .rst_ni  ( rst_ni   ),
         .clk_i   ( clk_i    ),
diff --git a/rtl/verilog/rl_ram_1r1w_generic.sv b/rtl/verilog/rl_ram_1r1w_generic.sv
index 5f0516b..6eefe79 100644
--- a/rtl/verilog/rl_ram_1r1w_generic.sv
+++ b/rtl/verilog/rl_ram_1r1w_generic.sv
@@ -66,7 +66,8 @@
 
 module rl_ram_1r1w_generic #(
   parameter ABITS      = 10,
-  parameter DBITS      = 32
+  parameter DBITS      = 32,
+  parameter LOAD_FILE  = ""
 )
 (
   input                        rst_ni,
@@ -91,8 +92,13 @@ module rl_ram_1r1w_generic #(
 
   logic [DBITS-1:0] mem_array [2**ABITS -1:0];  //memory array
 
-
+  // Load rom file if specified
+  generate
+     if (LOAD_FILE != "") begin : load_file
+        initial $readmemh (LOAD_FILE, mem_array);
+     end
+  endgenerate
+
   //////////////////////////////////////////////////////////////////
   //
   // Module Body
-- 
2.20.1

